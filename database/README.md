# Расчет дисковой подсистемы для базы данных социальной сети

На основе функциональных требований, DAU и нагрузки RPS.

---

## 1. Посты

- **RPS записи:** 24 (пик ×3 → 72)  
- **RPS чтения:** 2,300 (пик ×3 → 6,900)  
- **Средний размер строки:** 900 B  
- **Объем на год:** 2M постов/день × 365 × 900 B = 657 GB ×3 реплики +30% = **~2,6 TB**  
- **Трафик:** чтение + запись ≈ 6,900 × 900 B ≈ 6,2 MB/s → пик ×3 → **18,6 MB/s**  
- **IOPS:** 6,900  

| Тип диска | Достаточно по объему | Достаточно по throughput | Достаточно по IOPS | Рекомендуемые диски |
|-----------|--------------------|------------------------|------------------|------------------|
| HDD       | 0,08               | 0,186                  | 69               | 69               |
| SATA SSD  | 0,026              | 0,037                  | 6,9              | 7                |
| NVMe SSD  | 0,086              | 0,002                  | 0,69             | **3**            |

**Выбор:** NVMe SSD, 3 диска

---

## 2. Медиа постов (фото)

- **Загрузка:** 3 фото/пост × 2M постов/день = 6M фото/день  
- **Размер загрузки:** 6M × 1,6 MB = 9,6 TB/день (~111 MB/s)  
- **Чтение:** 20 постов × 10M DAU × 200 KB = 40 TB/день (~462 MB/s)  
- **Пиковый трафик:** ×3 → ≈1,386 GB/s  
- **Средний размер строки:** загрузка 1,6 MB, превью 200 KB  

| Тип диска | Достаточно по объему | Достаточно по throughput | Достаточно по IOPS | Рекомендуемые диски |
|-----------|--------------------|------------------------|------------------|------------------|
| HDD       | 373                | 173                    | -                | 373              |
| SATA SSD  | 120                | 12                     | -                | **120**          |
| NVMe SSD  | 154                | 2                      | -                | 154              |

**Выбор:** SATA SSD, 120 дисков

---

## 3. Комментарии

- **Запись:** 20M/день ≈ 230 RPS (пик ×3 → 690 RPS)  
- **Средний размер строки:** 173 B  
- **Объем на год:** 20M × 173 B ×2 реплики +30% ≈ 8,5 TB  
- **Трафик записи:** ≈ 1200 × 173 B ≈ 207 KB/s → пик ×3 ≈ 621 KB/s  

| Тип диска | Достаточно по объему | Достаточно по throughput | Достаточно по IOPS | Рекомендуемые диски |
|-----------|--------------------|------------------------|------------------|------------------|
| HDD       | 0,27               | 0,006                  | 6,9              | 7                |
| SATA SSD  | 0,085              | 0,001                  | 0,69             | **1**                |
| NVMe SSD  | 0,28               | 0,0002                 | 0,069            | 1                |

**Выбор:** SATA SSD, 1 диск

---

## 4. Лайки (Reactions)

- **Запись:** 11,600 RPS ×3 пик → 34,800 RPS  
- **Средний размер строки:** 42 B  
- **Объем на год:** 11,600 × 42 B ×2 реплики +30% ≈ 40 TB  
- **Трафик:** минимальный (байты)  

| Тип диска | Достаточно по объему | Достаточно по throughput | Достаточно по IOPS | Рекомендуемые диски |
|-----------|--------------------|------------------------|------------------|------------------|
| HDD       | 1,25               | 0,00023                | 34,800           | 34,800           |
| SATA SSD  | 0,4                | 0,000046               | 11,6             | 12               |
| NVMe SSD  | 1,1                | 0,0000077              | 3,48             | **4**                |

**Выбор:** NVMe SSD, 4 диска

---

## 5. Подписки (Follows)

- **Объем:** 240 GB ×2 реплики +30% = **624 GB**  
- **RPS записи:** 18 RPS (подписка/отписка), пик ×3 → 54 RPS  
- **Средний размер строки:** 24 B  
- **IOPS:** 54  

**Расчет дисков:**  

| Тип диска       | Дисков по capacity       | Дисков по throughput       | Дисков по IOPS       | Итоговое число |
|-----------------|-------------------------|----------------------------|---------------------|----------------|
| HDD (32 TB)     | 624 GB / 32 TB = 0,0195 | 0,000576 MB/s / 100 MB/s ≈ 0,00000576 | 54 / 100 = 0,54   | 1              |
| SSD SATA (100 TB)| 624 GB / 100 TB = 0,00624 | 0,000576 MB/s / 500 MB/s ≈ 0,00000115 | 54 / 1000 = 0,054 | **1**              |
| NVMe SSD (30 TB)| 624 GB / 30 TB ≈ 0,0208 | 0,000576 MB/s / 3,000 MB/s ≈ 0,00000019 | 54 / 10,000 = 0,0054 | 1            |

**Выбор:** SSD SATA, 1 диск

---

## 6. Пользователи (Users)

- **Объем:** 10M × 500 B ×2 реплики +30% = **~6.5 GB**  
- **RPS записи:** 100 RPS (обновления профиля), пик ×3 → 300 RPS  
- **Средний размер строки:** 500 B  
- **IOPS:** 300  

**Расчет дисков:**  

| Тип диска       | Дисков по capacity       | Дисков по throughput       | Дисков по IOPS       | Итоговое число |
|-----------------|-------------------------|----------------------------|---------------------|----------------|
| HDD (32 TB)     | 6.5 GB / 32 TB ≈ 0,0002 | 0,0012 MB/s / 100 MB/s ≈ 0,000012 | 300 / 100 = 3   | 3              |
| SSD SATA (100 TB)| 6.5 GB / 100 TB ≈ 0,000065 | 0,0012 / 500 ≈ 0,0000024 | 300 / 1000 = 0,3 | **1**              |
| NVMe SSD (30 TB)| 6.5 GB / 30 TB ≈ 0,00022 | 0,0012 / 3,000 ≈ 0,0000004 | 300 / 10,000 = 0,03 | 1            |

**Выбор:** SSD SATA, 1 диск

---

## 7. Локации (Locations)

- **Объем:** 1M × 200 B ×2 реплики +30% = **~0.52 GB**  
- **RPS записи:** 1 RPS, пик ×3 → 3 RPS  
- **Средний размер строки:** 200 B  
- **IOPS:** 3  

**Расчет дисков:**  

| Тип диска       | Дисков по capacity       | Дисков по throughput       | Дисков по IOPS       | Итоговое число |
|-----------------|-------------------------|----------------------------|---------------------|----------------|
| HDD (32 TB)     | 0.52 GB / 32 TB ≈ 0,000016 | 0,0006 MB/s / 100 MB/s ≈ 0,000006 | 3 / 100 = 0,03 | 1              |
| SSD SATA (100 TB)| 0.52 GB / 100 TB ≈ 0,0000052 | 0,0006 / 500 ≈ 0,0000012 | 3 / 1000 = 0,003 | **1**           |
| NVMe SSD (30 TB)| 0.52 GB / 30 TB ≈ 0,000017 | 0,0006 / 3,000 ≈ 0,0000002 | 3 / 10,000 = 0,0003 | 1            |

**Выбор:** SSD SATA, 1 диск

---

## 8. Жалобы (Reports)

- **Объем:** 1M × 400 B ×2 реплики +30% = **~1.04 GB**  
- **RPS записи:** 20 RPS, пик ×3 → 60 RPS  
- **Средний размер строки:** 400 B  
- **IOPS:** 60  

**Расчет дисков:**  

| Тип диска       | Дисков по capacity       | Дисков по throughput       | Дисков по IOPS       | Итоговое число |
|-----------------|-------------------------|----------------------------|---------------------|----------------|
| HDD (32 TB)     | 1.04 GB / 32 TB ≈ 0,000032 | 0,024 MB/s / 100 MB/s ≈ 0,00024 | 60 / 100 = 0,6 | 1              |
| SSD SATA (100 TB)| 1.04 GB / 100 TB ≈ 0,0000104 | 0,024 / 500 ≈ 0,000048 | 60 / 1000 = 0,06 | **1**           |
| NVMe SSD (30 TB)| 1.04 GB / 30 TB ≈ 0,0000347 | 0,024 / 3,000 ≈ 0,000008 | 60 / 10,000 = 0,006 | 1            |

**Выбор:** SSD SATA, 1 диск

---

## 9. Уведомления (Notifications)

- **Объем:** 100M/day × 300 B × 90 дней ×2 реплики +30% ≈ **9,828 PB**  
- **RPS записи:** 12,000 RPS, пик ×3 → 36,000 RPS  
- **Средний размер строки:** 300 B  
- **IOPS:** 51,000  

**Расчет дисков:**  

| Тип диска       | Дисков по capacity       | Дисков по throughput       | Дисков по IOPS       | Итоговое число |
|-----------------|-------------------------|----------------------------|---------------------|----------------|
| HDD (32 TB)     | 9,828 PB / 32 TB ≈ 307,125 | 15.3 MB/s / 100 MB/s ≈ 0,153 | 51,000 / 100 = 510 | 510              |
| SSD SATA (100 TB)| 9,828 PB / 100 TB ≈ 98,28 | 15.3 / 500 ≈ 0,0306 | 51,000 / 1000 = 51 | **98**           |
| NVMe SSD (30 TB)| 9,828 PB / 30 TB ≈ 327,6 | 15.3 / 3,000 ≈ 0,0051 | 51,000 / 10,000 = 5,1 | 328            |

**Выбор:** SSD SATA / архивное хранилище, горячий слой — NVMe, ~6 дисков

---

## 10. Настройки уведомлений (Notification_settings)

- **Объем:** 10M × 100 B ×2 реплики +30% = **~2.86 GB**  
- **RPS записи:** 50 RPS, пик ×3 → 150 RPS  
- **Средний размер строки:** 100 B  
- **IOPS:** 150  

**Расчет дисков:**  

| Тип диска       | Дисков по capacity       | Дисков по throughput       | Дисков по IOPS       | Итоговое число |
|-----------------|-------------------------|----------------------------|---------------------|----------------|
| HDD (32 TB)     | 2.86 GB / 32 TB ≈ 0,000089 | 0,015 MB/s / 100 MB/s ≈ 0,00015 | 150 / 100 = 1,5 | 2              |
| SSD SATA (100 TB)| 2.86 GB / 100 TB ≈ 0,0000286 | 0,015 / 500 ≈ 0,00003 | 150 / 1000 = 0,15 | **1**           |
| NVMe SSD (30 TB)| 2.86 GB / 30 TB ≈ 0,000095 | 0,015 / 3,000 ≈ 0,000005 | 150 / 10,000 = 0,015 | 1            |

**Выбор:** SSD SATA, 1 диск

---

## 11. Сессии (Sessions)

- **Объем:** 15M × 200 B ×2 реплики +30% = **~8.58 GB**  
- **RPS записи:** 500 RPS, пик ×3 → 1,500 RPS  
- **Средний размер строки:** 200 B  
- **IOPS:** 1,500  

**Расчет дисков:**  

| Тип диска       | Дисков по capacity       | Дисков по throughput       | Дисков по IOPS       | Итоговое число |
|-----------------|-------------------------|----------------------------|---------------------|----------------|
| HDD (32 TB)     | 8.58 GB / 32 TB ≈ 0,000268 | 0,33 MB/s / 100 MB/s ≈ 0,0033 | 1,500 / 100 = 15 | 15              |
| SSD SATA (100 TB)| 8.58 GB / 100 TB ≈ 0,0000858 | 0,33 / 500 ≈ 0,00066 | 1,500 / 1000 = 1,5 | **2**           |
| NVMe SSD (30 TB)| 8.58 GB / 30 TB ≈ 0,000286 | 0,33 / 3,000 ≈ 0,00011 | 1,500 / 10,000 = 0,15 | 1            |

**Выбор:** SSD SATA, 2 диска

---

## Итого по дискам

- **SSD (SATA):** 120 + 1 + 1 + 1 + 2 = **125 дисков**  
- **NVMe SSD:** 3 + 4 + 6 = **13 дисков**
