# Расчет дисковой подсистемы для базы данных социальной сети

На основе функциональных требований, DAU и нагрузки RPS.

## Характеристики дисков 
| Тип | Capacity | Throughput | IOPS | 
|-----|----------|------------|------| 
| **HDD SATA** | 32 TB | 100 MB/s | 100 | 
| **SSD SATA** | 100 TB | 500 MB/s | 1,000 | 
| **SSD NVMe** | 32 TB | 3,000 MB/s | 10,000 |

---

## 1. Посты

- **RPS записи:** 24 (пик ×3 → 72)  
- **RPS чтения:** 2,300 (пик ×3 → 6,900)  
- **Средний размер строки:** 900 B  
- **Объем на год:** 2M постов/день × 365 × 900 B = 657 GB × 3 реплики × 1,3 = **2,6 TB**  
- **Трафик чтения:** 6,900 × 900 B ≈ 6,21 MB/s
- **Трафик записи:** 72 × 900 B ≈ 0,065 MB/s
- **Общий трафик:** 6,275 MB/s
- **IOPS:** 72 + 6,900 = 6,972

| Тип диска | Достаточно по объему | Достаточно по throughput | Достаточно по IOPS | Рекомендуемые диски |
|-----------|--------------------|------------------------|------------------|------------------|
| HDD       | 2,6 / 32 = 0,081 | 6,275 / 100 = 0,063 | 6,972 / 100 = 69,72 | 70 |
| SATA SSD  | 2,6 / 100 = 0,026 | 6,275 / 500 = 0,013 | 6,972 / 1,000 = 6,972 | 7 |
| NVMe SSD  | 2,6 / 32 = 0,081 | 6,275 / 3,000 = 0,002 | 6,972 / 10,000 = 0,697 | **1** |

**Выбор:** NVMe SSD, 1 диск

---

## 2. Медиа постов (фото)

- **Загрузка:** 3 фото/пост × 2M постов/день = 6M фото/день  
- **Средний размер файла:** 1,6 MB  
- **Объем на год:** 6M × 1,6 MB × 365 = 3,504 PB × 2 реплики × 1,3 = **9,1 PB**
- **Чтение:** 20 постов × 10M DAU × 200 KB = 40 TB/день (~463 MB/s)  
- **Запись:** 6M × 1,6 MB / 86,400 s ≈ 111 MB/s
- **Пиковый трафик:** (111 + 463) × 3 = 1,722 MB/s  
- **RPS записи:** 6M / 86,400 s ≈ 69 RPS (пик ×3 → 207)
- **RPS чтения:** 200M / 86,400 s ≈ 2,315 RPS (пик ×3 → 6,945)
- **IOPS пиковый:** 207 + 6,945 = 7,152

| Тип диска   | Достаточно по объему | Достаточно по throughput | Достаточно по IOPS | Рекомендуемые диски |
|------------|--------------------|------------------------|------------------|------------------|
| HDD        | 9,1 PB / 32 TB = 284 | 1,722 / 100 = 17,22 | 7,152 / 100 = 71,52 | 284 |
| SATA SSD   | 9,1 PB / 100 TB = 91 | 1,722 / 500 = 3,44 | 7,152 / 1,000 = 7,152 | **91** |
| NVMe SSD   | 9,1 PB / 32 TB = 284 | 1,722 / 3,000 = 0,574 | 7,152 / 10,000 = 0,715 | 284 |

**Выбор:** SATA SSD, 91 диск (или использовать S3/MinIO лучше, но у меня не очень много опыта по работе с ним)

---

## 3. Комментарии

- **Запись:** 20M/день ≈ 231 RPS (пик ×3 → 693 RPS)  
- **Средний размер строки:** 173 B  
- **Объем на год:** 20M × 365 × 173 B × 2 реплики × 1,3 = **3,28 TB**
- **Трафик записи:** 693 × 173 B ≈ 0,12 MB/s
- **IOPS:** 693

| Тип диска | Достаточно по объему | Достаточно по throughput | Достаточно по IOPS | Рекомендуемые диски |
|-----------|--------------------|------------------------|------------------|------------------|
| HDD       | 3,28 / 32 = 0,103 | 0,12 / 100 = 0,0012 | 693 / 100 = 6,93 | 7 |
| SATA SSD  | 3,28 / 100 = 0,033 | 0,12 / 500 = 0,00024 | 693 / 1,000 = 0,693 | **1** |
| NVMe SSD  | 3,28 / 32 = 0,103 | 0,12 / 3,000 = 0,00004 | 693 / 10,000 = 0,069 | 1 |

**Выбор:** SATA SSD, 1 диск

---

## 4. Лайки (Reactions)

- **Запись:** 11,600 RPS (пик ×3 → 34,800 RPS)  
- **Средний размер строки:** 42 B  
- **Объем на год:** 11,600 × 86,400 × 365 × 42 B × 2 реплики × 1,3 = **32,5 TB**
- **Трафик записи:** 34,800 × 42 B ≈ 1,46 MB/s
- **IOPS:** 34,800

| Тип диска | Достаточно по объему | Достаточно по throughput | Достаточно по IOPS | Рекомендуемые диски |
|-----------|--------------------|------------------------|------------------|------------------|
| HDD       | 32,5 / 32 = 1,016 | 1,46 / 100 = 0,015 | 34,800 / 100 = 348 | 348 |
| SATA SSD  | 32,5 / 100 = 0,325 | 1,46 / 500 = 0,003 | 34,800 / 1,000 = 34,8 | 35 |
| NVMe SSD  | 32,5 / 32 = 1,016 | 1,46 / 3,000 = 0,0005 | 34,800 / 10,000 = 3,48 | **4** |

**Выбор:** NVMe SSD, 4 диска

---

## 5. Подписки (Follows)

- **Объем:** 240 GB × 2 реплики × 1,3 = **624 GB**  
- **RPS записи:** 18 RPS (пик ×3 → 54 RPS)  
- **Средний размер строки:** 24 B  
- **Трафик:** 54 × 24 B ≈ 0,0013 MB/s
- **IOPS:** 54

| Тип диска | Достаточно по объему | Достаточно по throughput | Достаточно по IOPS | Рекомендуемые диски |
|-----------|--------------------|-----------------------|------------------|------------------|
| HDD       | 0,624 / 32 = 0,019 | 0,0013 / 100 = 0,000013 | 54 / 100 = 0,54 | 1 |
| SATA SSD  | 0,624 / 100 = 0,006 | 0,0013 / 500 = 0,0000026 | 54 / 1,000 = 0,054 | **1** |
| NVMe SSD  | 0,624 / 32 = 0,019 | 0,0013 / 3,000 = 0,00000043 | 54 / 10,000 = 0,0054 | 1 |

**Выбор:** SATA SSD, 1 диск

---

## 6. Пользователи (Users)

- **Объем:** 10M × 500 B × 2 реплики × 1,3 = **13 GB**  
- **RPS записи:** 100 RPS (пик ×3 → 300 RPS)  
- **Средний размер строки:** 500 B  
- **Трафик:** 300 × 500 B ≈ 0,15 MB/s
- **IOPS:** 300

| Тип диска | Достаточно по объему | Достаточно по throughput | Достаточно по IOPS | Рекомендуемые диски |
|-----------|--------------------|-----------------------|------------------|------------------|
| HDD       | 0,013 / 32 = 0,0004 | 0,15 / 100 = 0,0015 | 300 / 100 = 3 | 3 |
| SATA SSD  | 0,013 / 100 = 0,00013 | 0,15 / 500 = 0,0003 | 300 / 1,000 = 0,3 | **1** |
| NVMe SSD  | 0,013 / 32 = 0,0004 | 0,15 / 3,000 = 0,00005 | 300 / 10,000 = 0,03 | 1 |

**Выбор:** SATA SSD, 1 диск

---

## 7. Локации (Locations)

- **Объем:** 1M × 200 B × 2 реплики × 1,3 = **520 MB**  
- **RPS записи:** 1 RPS (пик ×3 → 3 RPS)  
- **Средний размер строки:** 200 B  
- **Трафик:** 3 × 200 B ≈ 0,0006 MB/s
- **IOPS:** 3

| Тип диска | Достаточно по объему | Достаточно по throughput | Достаточно по IOPS | Рекомендуемые диски |
|-----------|--------------------|-----------------------|------------------|------------------|
| HDD       | 0,00052 / 32 = 0,000016 | 0,0006 / 100 = 0,000006 | 3 / 100 = 0,03 | 1 |
| SATA SSD  | 0,00052 / 100 = 0,0000052 | 0,0006 / 500 = 0,0000012 | 3 / 1,000 = 0,003 | **1** |
| NVMe SSD  | 0,00052 / 32 = 0,000016 | 0,0006 / 3,000 = 0,0000002 | 3 / 10,000 = 0,0003 | 1 |

**Выбор:** SATA SSD, 1 диск

---

## 8. Жалобы (Reports)

- **Объем:** 1M × 400 B × 2 реплики × 1,3 = **1,04 GB**  
- **RPS записи:** 20 RPS (пик ×3 → 60 RPS)  
- **Средний размер строки:** 400 B  
- **Трафик:** 60 × 400 B ≈ 0,024 MB/s
- **IOPS:** 60

| Тип диска | Достаточно по объему | Достаточно по throughput | Достаточно по IOPS | Рекомендуемые диски |
|-----------|--------------------|-----------------------|------------------|------------------|
| HDD       | 0,00104 / 32 = 0,000032 | 0,024 / 100 = 0,00024 | 60 / 100 = 0,6 | 1 |
| SATA SSD  | 0,00104 / 100 = 0,00001 | 0,024 / 500 = 0,000048 | 60 / 1,000 = 0,06 | **1** |
| NVMe SSD  | 0,00104 / 32 = 0,000032 | 0,024 / 3,000 = 0,000008 | 60 / 10,000 = 0,006 | 1 |

**Выбор:** SATA SSD, 1 диск

---

## 9. Уведомления (Notifications)

- **Объем за год:** 100M/day × 365 × 300 B × 2 реплики × 1,3 = **28,5 TB**
- **Хранение 90 дней:** 100M × 90 × 300 B × 2 реплики × 1,3 = **7 TB**
- **RPS записи:** 12,000 RPS (пик ×3 → 36,000 RPS)  
- **RPS чтения:** ~15,000 RPS (пик ×3 → 45,000 RPS)
- **Средний размер строки:** 300 B  
- **Трафик:** (36,000 + 45,000) × 300 B ≈ 24,3 MB/s
- **IOPS:** 81,000

| Тип диска | Достаточно по объему | Достаточно по throughput | Достаточно по IOPS | Рекомендуемые диски |
|-----------|--------------------|-----------------------|------------------|------------------|
| HDD       | 7 / 32 = 0,219 | 24,3 / 100 = 0,243 | 81,000 / 100 = 810 | 810 |
| SATA SSD  | 7 / 100 = 0,07 | 24,3 / 500 = 0,049 | 81,000 / 1,000 = 81 | **81** |
| NVMe SSD  | 7 / 32 = 0,219 | 24,3 / 3,000 = 0,008 | 81,000 / 10,000 = 8,1 | **9** |

**Выбор:** NVMe SSD для горячих данных (90 дней), 9 дисков, для остального 81 SATA SSD

---

## 10. Настройки уведомлений (Notification_settings)

- **Объем:** 10M × 100 B × 2 реплики × 1,3 = **2,6 GB**  
- **RPS записи:** 50 RPS (пик ×3 → 150 RPS)  
- **Средний размер строки:** 100 B  
- **Трафик:** 150 × 100 B ≈ 0,015 MB/s
- **IOPS:** 150

| Тип диска | Достаточно по объему | Достаточно по throughput | Достаточно по IOPS | Рекомендуемые диски |
|-----------|--------------------|-----------------------|------------------|------------------|
| HDD       | 0,0026 / 32 = 0,000081 | 0,015 / 100 = 0,00015 | 150 / 100 = 1,5 | 2 |
| SATA SSD  | 0,0026 / 100 = 0,000026 | 0,015 / 500 = 0,00003 | 150 / 1,000 = 0,15 | **1** |
| NVMe SSD  | 0,0026 / 32 = 0,000081 | 0,015 / 3,000 = 0,000005 | 150 / 10,000 = 0,015 | 1 |

**Выбор:** SATA SSD, 1 диск

---

## 11. Сессии (Sessions)

- **Объем:** 15M × 200 B × 2 реплики × 1,3 = **7,8 GB**  
- **RPS записи:** 500 RPS (пик ×3 → 1,500 RPS)  
- **Средний размер строки:** 200 B  
- **Трафик:** 1,500 × 200 B ≈ 0,3 MB/s
- **IOPS:** 1,500

| Тип диска | Достаточно по объему | Достаточно по throughput | Достаточно по IOPS | Рекомендуемые диски |
|-----------|--------------------|-----------------------|------------------|------------------|
| HDD       | 0,0078 / 32 = 0,000244 | 0,3 / 100 = 0,003 | 1,500 / 100 = 15 | 15 |
| SATA SSD  | 0,0078 / 100 = 0,000078 | 0,3 / 500 = 0,0006 | 1,500 / 1,000 = 1,5 | **2** |
| NVMe SSD  | 0,0078 / 32 = 0,000244 | 0,3 / 3,000 = 0,0001 | 1,500 / 10,000 = 0,15 | 1 |

**Выбор:** SATA SSD, 2 диска

---

## Итого по дискам

- **SSD SATA:** 91 + 1 + 1 + 1 + 1 + 1 + 81 + 1 + 2 = **180 дисков**  
- **NVMe SSD:** 1 + 4 + 9 = **14 дисков**
- 